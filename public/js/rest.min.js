
const rest = {
    /**
    * @param mType: body | form
    */
    post: function(mUrl, mData, mType="body"){
        if(mType == "body"){
            return $.ajax({
                "url": mUrl,
                "method": "POST",
                "cache": false,
                "timeout": 0,
                "headers": {"Content-Type": "application/json"},
                "data": JSON.stringify(mData)
            })
        }else{
            return $.ajax({
                "type": "POST",
                "data": mData,
                "url": mUrl,
                "enctype": 'multipart/form-data',
                "processData": false,
                "contentType": false,
                "cache": false
            })
        }
    },
    get: function(mUrl, mData){
        return $.ajax({
            "type": "GET",
            "url": mUrl,
            "data": mData,
            "contentType": "application/json charset=utf-8",
        })
    }
}

const API = {
    OP: {
        PLAN: {
            list: async function(param){
                $("#loader").removeClass("loaded")
                const api = `/op/api/plan/list`
                const res = await $.when(rest.get(api, param))
                $("#loader").addClass("loaded")
                return res
            }
        },
        ORDER: {
            list: async function(param){
                $("#loader").removeClass("loaded")
                const api = `/op/api/order/list`
                const res = await $.when(rest.get(api, param))
                $("#loader").addClass("loaded")
                return res
            }
        }
    },
    QA: {
        PLAN: {
            list: async function(param){
                $("#loader").removeClass("loaded")
                const api = `/qa/api/plan/list`
                const res = await $.when(rest.get(api, param))
                $("#loader").addClass("loaded")
                return res
            }
        }
    },
    WH: {
        ORDER: {
            list: async function(param){
                $("#loader").removeClass("loaded")
                const api = `/wh/api/warehouse/list`
                const res = await $.when(rest.get(api, param))
                $("#loader").addClass("loaded")
                return res
            }
        }
    },
    ADMIN: {
        PLAN: {
            statistic: async function(param){
                $("#loader").removeClass("loaded")
                const api = `/admin/api/plan/statistic`
                const res = await $.when(rest.get(api, param))
                $("#loader").addClass("loaded")
                return res
            },
            /**
             * @description: Export for input
             * */
            export: async function(id){
                $("#loader").removeClass("loaded")
                const api = `/admin/api/plan/${id}/export`
                const res = await $.when(rest.get(api, null))

                var a = document.createElement('a')
                a.href = `data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheetbase64,${res.data}`
                a.download = 'du_lieu_nhap_kho.xlsx'
                a.click()
                $("#loader").addClass("loaded")

                return res
            },
        },
        WAREHOUSE: {
            statistic: async function(param){
                $("#loader").removeClass("loaded")
                const api = `/admin/api/warehouse/statistic`
                const res = await $.when(rest.get(api, param))
                $("#loader").addClass("loaded")
                return res
            },
        }
    },
    SELLER: {
        ORDER: {
            create: async function(param){
                $("#loader").removeClass("loaded")
                const api = `/seller/api/order/create`
                const res = await $.when(rest.post(api, param))
                $("#loader").addClass("loaded")
                return res
            }
        }
    },
    /**
     * Common
     * */
    CAKE: {
        names: async function(){
            $("#loader").removeClass("loaded")
            const api = `/api/cake/names`
            const res = await $.when(rest.get(api, null))
            $("#loader").addClass("loaded")
            return res
        },
        codes: async function(){
            $("#loader").removeClass("loaded")
            const api = `/api/cake/codes`
            const res = await $.when(rest.get(api, null))
            $("#loader").addClass("loaded")
            return res
        },
        list: async function(idGroup){
            const api = `/admin/api/cake/list`
            const param = {"idCakeGroup": idGroup}
            const res = await $.when(rest.get(api, param))
            return res
        }
    },
    MATERIAL: {
        names: async function(){
            $("#loader").removeClass("loaded")
            const api = `/api/material/names`
            const res = await $.when(rest.get(api, null))
            $("#loader").addClass("loaded")
            return res
        },
    },
    USER: {
        findByPhone: async function(phone){
            $("#loader").removeClass("loaded")
            const api = `/api/user/phone/${phone}`
            const res = await $.when(rest.get(api, null))
            $("#loader").addClass("loaded")
            return res
        },
        findByUsername: async function(username){
            $("#loader").removeClass("loaded")
            const api = `/api/user/${username}`
            const res = await $.when(rest.get(api, null))
            $("#loader").addClass("loaded")
            return res
        },
        findByCode: async function(code){
            $("#loader").removeClass("loaded")
            const api = `/api/user/code/${code}`
            const res = await $.when(rest.get(api, null))
            $("#loader").addClass("loaded")
            return res
        },
        register: async function(param){
            /**
            * @param: {code, fullName, email, address, phone, birth, gender}
            */
            $("#loader").removeClass("loaded")
            const api = `/api/user/register`
            const res = await $.when(rest.post(api, param))
            $("#loader").addClass("loaded")
            return res
        }
    },
    MEDIA: {
        upload: async function(file){
            $("#loader").removeClass("loaded")
            var formData = new FormData()
            formData.append("file", file)
            const api = `/api/media/upload`
            const res = await $.when(rest.post(api, formData, "form"))
            $("#loader").addClass("loaded")
            return res
        }
    }
}